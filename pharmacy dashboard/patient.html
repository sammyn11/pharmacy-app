<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Patient Page</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
    <h2>Welcome, <span id="patientName"></span>!</h2>
    <button onclick="logout()" style="margin-bottom:15px;">Logout</button>

    <div class="card">
        <h3>Place an Order</h3>
        <select id="medSelect">
            <option value="">Select Medicine</option>
        </select>
        <input type="number" id="orderQty" placeholder="Quantity" min="1">
        <button onclick="placeOrder()">Place Order</button>
    </div>

    <div class="card">
        <h3>Your Orders</h3>
        <ul id="patientOrdersList"></ul>
    </div>
</div>

<script src="script.js"></script>
<script>
const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
if(!currentUser || currentUser.role !== "patient"){
    alert("Access denied. Login as patient.");
    window.location.href="index.html";
}

document.getElementById('patientName').textContent = currentUser.name;

// Populate medicine dropdown
function populateMedicineOptions(){
    const medSelect = document.getElementById('medSelect');
    medSelect.innerHTML = '<option value="">Select Medicine</option>';
    const medicines = JSON.parse(localStorage.getItem('medicines')) || [];
    medicines.forEach(m => {
        const option = document.createElement('option');
        option.value = m.name;
        option.textContent = `${m.name} - ${m.qty} in stock - ${m.price} RWF`;
        medSelect.appendChild(option);
    });
}

// Place order
function placeOrder(){
    const med = document.getElementById('medSelect').value;
    const qty = parseInt(document.getElementById('orderQty').value);
    if(!med || isNaN(qty) || qty < 1){alert("Select medicine and quantity."); return;}

    let orders = JSON.parse(localStorage.getItem('orders')) || [];
    orders.push({patient: currentUser.name, med, qty, verified:false});
    localStorage.setItem('orders', JSON.stringify(orders));

    alert(`Order placed: ${med} x ${qty}`);
    document.getElementById('orderQty').value = '';
    populateOrders();
    populateMedicineOptions();
}

// Display patient orders
function populateOrders(){
    const list = document.getElementById('patientOrdersList');
    list.innerHTML = '';
    const orders = JSON.parse(localStorage.getItem('orders')) || [];
    orders.filter(o => o.patient === currentUser.name).forEach(order => {
        const li = document.createElement('li');
        li.textContent = `${order.med} x ${order.qty} - ${order.verified ? 'Verified âœ…' : 'Pending'}`;
        list.appendChild(li);
    });
}

// Logout
function logout(){
    sessionStorage.removeItem('currentUser');
    window.location.href = "index.html";
}

// Initialize page
populateMedicineOptions();
populateOrders();
</script>
</body>
</html>
